<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>Contextual</title>
    <script type="text/javascript" src="js/reveal.js/js/reveal.js"></script>
    <link href="js/reveal.js/css/reveal.css" rel="stylesheet"/>
    <link href="js/reveal.js/css/theme/moon.css" rel="stylesheet"/>
    <script type="text/javascript" src="js/reveal.js/lib/js/head.min.js"></script>
    <script type="text/javascript" src="js/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="js/lodash/lodash.js"></script>
    <link rel="stylesheet" href="js/highlightjs/styles/tomorrow-night.css"/>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,600italic,700,400italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if (window.location.search.match(/print-pdf/gi)) {
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'js/reveal.js/css/print/pdf.css';
        document.getElementsByTagName('head')[0].appendChild(link);
      }
    </script>
    <!--[if lt IE 9]>
    <script src="js/reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
    <link href="css/presentation.css" rel="stylesheet"/>
  </head>

  <body>
    <div class="reveal">

      <div class="slides">

<section data-state="title-slide">
  <div class="title">
    <h1>Contextual</h1>
    <h2>simple and typesafe interpolated strings, checked at compile-time</h2>

    <p class="centered">
      Brian Clapper, <i>@brianclapper</i><br/>
      <i>bmc@ardentex.com</i>
    </p>
  </div>
</section>
<section>
  <h1>What is Contextual?</h1>

  <ul>
    <li class="fragment">Allows you to define your own string interpolators</li>
    <li class="fragment">... that are checked at <i>compile time</i></li>
  </ul>
</section>
<section>
  <h1>What is a "string interpolator"?</h1>

  <p>
    You've seen them before. Some are built into Scala:
  </p>

  <p class="fragment">
    Simple string interp:

      <pre class="code fragment">
        <code class="scala data-trim">
          val age = 10
          val name = "Jenna"
          println(s"My name is $name, and I am $age years old.")
        </code>
      </pre>
  </p>

  <p class="fragment">
    <code>printf</code>-style interp (checked at compile time!):
    <pre class="code fragment">
      <code class="scala data-trim">
        println(f"My name is $name%20s, and I am $age%2d years old.")
      </code>
    </pre>
  </p>
</section>
<section>
  <h1>Other examples</h1>

  <ul>
    <li>
      Apache Spark's DataFrame API provides a "$" interpolator as a convenient
      column reference: <code>$"name"</code>, <code>$"salary"</code>
    </li>
    <li>
      The <a href="http://slick.lightbend.com/">Slick</a> API has a
      SQL interpolator: <code>sql"SELECT * FROM ..."</code>
    </li>
  </ul>

</section>
<section>
  <h1>You can write your own</h1>

  <p>
    As noted at
    <a href="http://docs.scala-lang.org/overviews/core/string-interp.html">
      http://docs.scala-lang.org/overviews/core/string-interp.html
    </a>,
    whenever the compiler sees
  </p>

  <p><br/><code>id"something"</code><br/><br/></p>

  <p>
    it looks for an <code>id()</code> method on <code>StringContext</code>.
    If such a method is found, the compiler parses the string into prefixes
    and arguments, instantiating a <code>StringContext</code> with the
    prefixes and passing the arguments into the <code>id()</code> method.
  </p>

</section>
<section>
  <h1>You can write your own</h1>

  <p>What the hell does <i>that</i> mean?</p>

  <p class="fragment">Suppose you code this:</p>

  <pre class="code fragment">
    <code class="scala data-trim">
      json"{ name: $name, id:$id }"
    </code>
  </pre>

  <p class="fragment">
    The compiler converts that to:
  </p>

  <pre class="code fragment">
    <code class="scala data-trim">
      new StringContext("{name: ", " id: ", "}").json(name, id)
    </code>
  </pre>

</section>
<section>
  <h1>Let's take a look at an example</h1>

  <p>Time for some code...</p>

</section>
<section>
  <h1>How do you get <i>compile-time</i> evaluation?</h1>

  <p>
    The previous example failed at runtime. How do you implement a string
    interpolator that fails at compile time, the way the "f" interpolator
    does?
  </p>

  <p class="fragment">
    Short answer: Compiler macros.
  </p>

  <p class="fragment">
    Macros can be quite complicated. They expose the compiler's AST, and
    the macro writer is often required to manipulate the AST and perform
    type-level programming.
  </p>
</section>
<section>
  <h1>There's an easier way.</h1>

  <p class="fragment">
    It's called Contextual.
  </p>

  <p class="fragment">
    Contextual hides all the macro fiddling, providing a simpler (though not
    entirely simplistic) API that allows you to specify the compile-time and
    runtime behavior of your interpolator.
  </p>
</section>
<section>
  <h1>How does it work?</h1>

  <p class="fragment">
    Basic approach:
  </p>

  <ul>
    <li class="fragment">
      Add the necessary imports.
    </li>
    <li class="fragment">
      Create an <i>object</i> that subclasses <code>Interpolator</code>.
    </li>
    <li class="fragment">
      Implement the <code>contextualize()</code> method to provide any
      compile-time checks you want.
    </li>
    <li class="fragment">
      Implement the <code>evaluate()</code> method to provide the runtime
      behavior.
    </li>
    <li class="fragment">
      Create an implicit class to add the appropriate interpolator method
      to the Scala <code>StringContext</code> class.
    </li>
  </ul>
</section>
<section>
  <h1>A Contextual "regex" interpolator</h1>

  <p>
    Let's reimplement our "regex" interpolator in Contextual. (Time for more
    code.)
  </p>
</section>
<section>
  <h1>What about substitution?</h1>

  <p class="fragment">
    Let's look at an "sh" interpolator that:
  </p>

  <ul>
    <li class="fragment">
      allows embedded quotes
    </li>
    <li class="fragment">
      supports compile-time syntax checks
    </li>
    <li class="fragment">
      allows substitution (with some restrictions)
    </li>
  </ul>

  <p class="fragment">
    We'll also look at a class that removes that final
    restriction.
  </p>

  <p class="fragment">(Back to IntelliJ.)</p>
</section>
<section>
  <h1>Conclusion</h1>

  <p>
    This API isn't exactly <i>simple</i>. But if you want compile-time interpolator
    checks, it's far simpler than the alternative.
  </p>

  <p>
    There's a Gitter channel devoted to Contextual, where you can ask questions.
  </p>

  <p>
    Jon Pretty is a <i>very</i> nice fellow. Don't be afraid to ask questions.
    Also, don't be afraid to suggest updates.
  </p>

  <h2>Questions?</h2>
</section>

      </div>
    </div>

    <div id="footer">
      <span class="databricks">
        <img src="images/ardentex-logo.png" alt="ArdenTex" class="ardentex-logo"/>
      </span>
    </div>
  </body>

  <script type="text/javascript" src="js/presentation.js"></script>
</html>
